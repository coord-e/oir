on: push

name: latest

jobs:
  test:
    name: test
    runs-on: ubuntu-latest
    strategy:
      matrix:
        debug: [1, 0]
        sanitizer: [1, 0]
        compiler: [gcc, clang]
        exclude:
          - debug: 0
            sanitizer: 1
    steps:
    - uses: actions/checkout@master
    - run: make test.image
      env:
        DEBUG: ${{ matrix.debug }}
        SANITIZER: ${{ matrix.sanitizer }}
        CC: ${{ matrix.compiler }}
  check_style:
    name: check code style
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - name: Install clang-format
      run: |
        sudo apt-get update
        sudo apt-get install -y --no-install-recommends clang-format
    - name: Prepare run-clang-format
      run: |
        wget https://raw.githubusercontent.com/Sarcasm/run-clang-format/master/run-clang-format.py
        chmod +x run-clang-format.py
    - run: ./run-clang-format.py -r src
